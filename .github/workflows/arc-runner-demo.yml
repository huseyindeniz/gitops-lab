name: Actions Runner Controller Demo
on:
  workflow_dispatch:

jobs:
  Explore-GitHub-Actions:
    runs-on: arc-runner
    steps:
      - name: greeting
        run: echo "ðŸŽ‰ This job uses runner scale set runners!"
      - name: Set up kubectl
        uses: azure/setup-kubectl@v1
        # Use the default service account token for kubectl authentication
      - name: Set up kubeconfig from service account
        run: |
          echo "Setting up kubeconfig from service account..."
          kubectl config set-cluster minikube --server=https://kubernetes.default.svc --certificate-authority=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          kubectl config set-credentials arc-runner-gha-rs-no-permission --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
          kubectl config set-context default --cluster=minikube --user=arc-runner-gha-rs-no-permission
          kubectl config use-context default
      - name: Check if kubectl is working 
        run: |
          echo "Checking if kubectl is working..."
          kubectl version
      - name: Check if kubectl has access to apps
        run: |
          echo "Checking if kubectl has permissions to access project-001-wf-local resources"
          kubectl get pods -n project-001-wf-local-stag-1
