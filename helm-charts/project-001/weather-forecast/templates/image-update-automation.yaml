apiVersion: image.toolkit.fluxcd.io/v1beta2
kind: ImageUpdateAutomation
metadata:
  name: {{ .Release.Name }}-image-update
  namespace: {{ .Values.namespace }}-{{ .Values.environment }}
spec:
  interval: 1m
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  update:
    strategy: Setters  # This tells Flux to update Kubernetes resources directly
  git:
    commit:
      author:
        email: "automation@flux-system"
        name: flux
    push:
      branch: main  # Your Git branch (but we will not commit or push)
    commitTemplate:
      message: '[skip ci] Update image for weather-forecast'
